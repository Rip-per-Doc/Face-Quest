let player;
let bullets, arrows, missiles, flames, explosion;
let broadSword, shortSword, ZweiHander, fireAxe, battleAxe, hatchet, wingedSpear, katana, dagger, knife
let devRoom, Lvl1, Lvl2, Lvl3, Lvl4
let walls
let currentWeapon;
function setup() {
	new Canvas(1920, 1080);
	displayMode('centered')

	player = new Sprite(400,400);
    player.h = 28
    player.w = 28
    player.physics = 'd'
    

	projectiles = new Group()
    projectiles.speed = 7
    projectiles.color = 'yellow'

	walls = new Group()
	walls.w = 32 // sets sprite width
	walls.h = 32 // sets sprite height
	walls.tile = 'b' // defines which tiles are in this group
	walls.color = 'white'
	walls.physics = 's' // makes the tiles in this group static objects

    playerSpawn = new Group()
    playerSpawn.tile = 'l'
    playerSpawn.physics = 'n'

    weapon = new Group()
    weapon.type = ''


    rustyRevolver = new weapon.Group()
    rustyRevolver.type = 'blast'
    rustyRevolver.img = 'rustyRevolver.png'
    rustyRevolver.image.scale = 2
    rustyRevolver.bullets = 300

    rustyShotgun = new weapon.Group()
    rustyShotgun.type = 'blast'
    

    currentWeapon = new rustyRevolver.Sprite() // test
    currentWeapon.x = player.x + 40
    currentWeapon.y = player.y
    currentWeapon.physics = 'd'
    
    

    weaponJoint = new RopeJoint(player, currentWeapon)
    weaponJoint.maxStrength = 0



	devRoom = new Tiles(levels[0],0,0,32,32)
    }

function preload(){
    loadImage('rustyRevolver.png')
}

function move(){
    camera.on //activates camera control 
    camera.x = player.x //makes camera follow player horizontally
    camera.y = player.y //makes camera follow player vertically
    if (kb.pressing('a')){
        player.vel.x = -2
    }
    else if(kb.pressing('d')){
        player.vel.x = 2
    }
   
    else{
        player.vel.x = 0
    }
   
    if(kb.pressing('w')){
        player.vel.y = -2
    }
   
    else if(kb.pressing('s')){
        player.vel.y = 2
    }
   
    else{
        player.vel.y = 0
    }
    if (mouse.pressed()){
        attack()
    }
    camera.off //deactivates camera control
}

async function attack(){
    if(currentWeapon.type == 'single'){    
        let p = new projectiles.Sprite(currentWeapon.x,currentWeapon.y, 7,7)
        p.direction = p.angleTo(mouse)
        p.color = 'yellow'
    }
    
    if(currentWeapon.type == 'blast'){    
        for(i=0; i< currentWeapon.bullets; i++){
            let p = new projectiles.Sprite(currentWeapon.x,currentWeapon.y, 7,7)
            p.direction = p.angleTo(mouse) + random(-20, 20)
        }
    }
    
    if(currentWeapon.type == 'burst'){    
    let a = new projectiles.Sprite(currentWeapon.x,currentWeapon.y, 7,7)
    a.direction = a.angleTo(mouse)
    await delay(250)
    let b = new projectiles.Sprite(currentWeapon.x,currentWeapon.y, 7,7)
    b.direction = b.angleTo(mouse)
    await delay(250)
    let c = new projectiles.Sprite(currentWeapon.x,currentWeapon.y, 7,7)
    c.direction = c.angleTo(mouse)
    }
}

function draw(){
	background('black');

}

function update(){
	move()
    currentWeapon.rotateMinTo(mouse,20)
    currentWeapon.moveTo(mouse, 5)
	for (p of projectiles){
		for (w of walls){
			if (p.collides(w)){
				p.remove()
			}
		}
	}
}


let levels = [
    ["..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"........................bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b...............l......................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb............................................................................................................b..........",
"...................................................................................................................................bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb..........",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",],0,0,32,32

]