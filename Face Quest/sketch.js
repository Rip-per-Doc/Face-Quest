let player;
let bullets, arrows, missiles, flames, explosion;
let broadSword, shortSword, ZweiHander, fireAxe, battleAxe, hatchet, wingedSpear, katana, dagger, knife
let devRoom, Lvl1, Lvl2, Lvl3, Lvl4
let walls
let currentWeapon;
function setup() {
	new Canvas(1920, 1080);
	displayMode('centered')

	player = new Sprite(400,400);
    player.h = 28
    player.w = 28
    player.physics = 'd'
    

	projectiles = new Group()
    projectiles.speed = 7
    projectiles.color = 'yellow'

	walls = new Group()
	walls.w = 32 // sets sprite width
	walls.h = 32 // sets sprite height
	walls.tile = 'b' // defines which tiles are in this group
	walls.color = 'white'
	walls.physics = 's' // makes the tiles in this group static objects

    playerSpawn = new Group()
    playerSpawn.tile = 'l'
    playerSpawn.physics = 'n'


    weapon = new Group()
    weapon.type = ''
    weapon.id = ''

    

    inventory = new Group()
    //declaring WEAPON inventory slots within the group
    inventory.Wslot1 = '1'
    inventory.Wslot2 = '2'
    inventory.Wslot3 = ''
    //declaring MAGIC weapon slots within the froup
    inventory.Mslot1 = ''
    inventory.Mslot2 = ''
    inventory.Mslot3 = ''
    inventory.Mslot4 = ''


    
    rustyRevolver = new weapon.Group()
    rustyRevolver.type = 'burst'
    rustyRevolver.img = 'rustyRevolver.png'
    rustyRevolver.image.scale = 2
    rustyRevolver.bullets = 3
    rustyRevolver.id = 1

    rustyShotgun = new weapon.Group()
    rustyShotgun.type = 'blast'
    rustyShotgun.spreadLow = -35
    rustyShotgun.spreadHigh = 35
    rustyShotgun.img = 'na.png'
    rustyShotgun.image.scale = 2
    rustyShotgun.bullets = 5
    rustyShotgun.id = 2

    //heldWeapon is used to define the physical object of the weapon, while equippedWeapon is used to determine weapon statistics
    equippedWeapon = rustyRevolver
    heldWeapon = new equippedWeapon.Sprite() // test
    heldWeapon.x = player.x + 40
    heldWeapon.y = player.y
    heldWeapon.physics = 'd'
    
    

    weaponJoint = new RopeJoint(player, equippedWeapon)
    weaponJoint.maxStrength = 0



	devRoom = new Tiles(levels[0],0,0,32,32)
    }

function preload(){
    loadImage('rustyRevolver.png')
    loadImage('na.png')
}

function move(){
    camera.on //activates camera control 
    camera.x = player.x //makes camera follow player horizontally
    camera.y = player.y //makes camera follow player vertically
    if (kb.pressing('a')){
        player.vel.x = -2
    }
    else if(kb.pressing('d')){
        player.vel.x = 2
    }
   
    else{
        player.vel.x = 0
    }
   
    if(kb.pressing('w')){
        player.vel.y = -2
    }
   
    else if(kb.pressing('s')){
        player.vel.y = 2
    }
   
    else{
        player.vel.y = 0
    }
    if (mouse.pressed()){
        attack()
    }
    camera.off //deactivates camera control
}

function equip(){//if blah blah pressed, equip weapon where weapon id = id in inventory slot
    if (keyboard.pressed('1')){
        equippedWeapon.id =  inventory.Wslot1
    }
    if (keyboard.pressed('2')){
        equippedWeapon.id =  inventory.Wslot1
    }
}

async function attack(){
    if(equippedWeapon.type == 'single'){   //causes weapon to fire one projectile in direction of the mouse 
        let p = new projectiles.Sprite(equippedWeapon.x,equippedWeapon.y, 7,7)
        p.direction = p.angleTo(mouse)
        p.color = 'yellow'
    }
    
    if(equippedWeapon.type == 'blast'){  //causes weapon to fire a clump of bullets in a random direction (lower and upper bounds dictated in individual weapon group), but still towards the mouse
        for(i=0; i< equippedWeapon.bullets; i++){
            let p = new projectiles.Sprite(equippedWeapon.x,equippedWeapon.y, 7,7)
            p.direction = p.angleTo(mouse) + random(equippedWeapon.spreadLow, equippedWeapon.spreadHigh)
        }
    }
    
    if(equippedWeapon.type == 'burst'){  //causes weapon to fire a short barrage towards the mouse, but with a small time between each shot 
        for(i=0; i< equippedWeapon.bullets; i++){
            let p = new projectiles.Sprite(equippedWeapon.x,equippedWeapon.y, 7,7)
            p.direction = p.angleTo(mouse)
            await delay(equippedWeapon.burstSpeed)
        }
    }
}

function draw(){
	background('black');

    }

function update(){
	move()
    equip()
    heldWeapon.rotateMinTo(mouse,20)
    heldWeapon.moveTo(mouse, 5)
	for (p of projectiles){
		for (w of walls){
			if (p.collides(w)){
				p.remove()
			    }
		    }
	    }
    }

let levels = [
    ["..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"........................bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b...............l......................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
"........................b......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................b.......................................................................................................................................................................................................................b..........",
".......................bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb............................................................................................................b..........",
"...................................................................................................................................bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb..........",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",
"..........................................................................................................................................................................................................................................................",],0,0,32,32

]